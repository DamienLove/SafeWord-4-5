rules_version = '2';
service cloud.firestore {
    match /databases/{database}/documents {
        match /users/{userId} {
            allow read, write: if request.auth != null && request.auth.uid == userId;
            match /users/{userId}/contacts/{contactId} {
                allow read, write: if request.auth.uid == userId;
            }
            match /users/{userId}/safeWords/{safeWordId} {
                allow read, write: if request.auth.uid == userId;
            }
        }
        match /alerts/{alertId} {
            allow create: if request.auth != null && request.auth.uid == request.resource.data.triggeredById;
            allow read: if request.auth != null &&
                    (request.auth.uid == resource.data.currentFriendId || request.auth.uid == resource.data.triggeredById);
            allow update: if request.auth != null &&
                    ((request.auth.uid == resource.data.currentFriendId && request.resource.data.callRequested == true) ||
                            request.auth.uid == resource.data.triggeredById);
        }
    }
}
